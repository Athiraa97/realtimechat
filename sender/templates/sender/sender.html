<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Sender — Send Notification</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

  <div class="container py-5">
    <div class="row justify-content-center">
      <div class="col-md-6">
        <div class="card shadow-sm border-0 rounded-3 mb-4">
          <div class="card-body p-4">
            <h3 class="card-title text-center mb-4">Send Notification</h3>

            <div class="mb-3">
              {% comment %} <label for="messageInput" class="form-label">Notification Message</label> {% endcomment %}
              <input type="text" id="messageInput" class="form-control" placeholder="Type a message">
            </div>

            <div class="d-grid">
              <button id="sendBtn" class="btn btn-primary btn-lg">Send</button>
            </div>

            <div id="status" class="mt-3 text-center text-muted small"></div>
          </div>
        </div>

        <!-- Sent messages list -->
        {% comment %} <div class="card shadow-sm border-0 rounded-3">
          <div class="card-body p-4">
            <h5 class="card-title mb-3">Sent Messages</h5>
            <ol id="sentMessages" class="list-group list-group-numbered"></ol>
          </div>
        </div> {% endcomment %}
      </div>
    </div>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    const loc = window.location;
    const wsScheme = loc.protocol === "https:" ? "wss" : "ws";
    const wsUrl = `${wsScheme}://${loc.host}/ws/notifications/`;
    const socket = new WebSocket(wsUrl);

    const status = document.getElementById("status");
    const sentMessages = document.getElementById("sentMessages");

    socket.addEventListener("open", function() {
      status.textContent = "Connected to server ✅";
      status.classList.remove("text-danger");
      status.classList.add("text-success");
    });

    socket.addEventListener("message", function(e) {
      console.log("Message to sender:", e.data);
    });

    socket.addEventListener("close", function() {
      status.textContent = "Disconnected ❌";
      status.classList.remove("text-success");
      status.classList.add("text-danger");
    });

    document.getElementById("sendBtn").addEventListener("click", function() {
      const msgInput = document.getElementById("messageInput");
      const msg = msgInput.value.trim() || "Hello from Sender";

      // Send via WebSocket
      socket.send(JSON.stringify({ message: msg }));

      // Append to Sent Messages list
      const li = document.createElement("li");
      li.className = "list-group-item d-flex justify-content-between align-items-center";
      li.innerHTML = `<span>${msg}</span> <small class="text-muted">${new Date().toLocaleTimeString()}</small>`;
      sentMessages.appendChild(li);

      msgInput.value = "";
      msgInput.focus();
    });
  </script>
</body>
</html>
